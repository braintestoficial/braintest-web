<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>QI — Relatório Premium | Braintest</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@600&display=swap" rel="stylesheet">
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="assets/supabase-init.js"></script>
<style>
:root{--salmao:#ff8a73;--salmao-2:#ff7458;--azul:#1d3557;--bg:#f6f7fb;--card:#fff;--borda:#e9ecf2;--texto:#2b2b2b}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--texto)}
.wrap{max-width:1000px;margin:0 auto;padding:1rem}
header.top{display:flex;align-items:center;justify-content:space-between;background:#fff;border:1px solid var(--borda);border-radius:14px;padding:1rem;margin-top:1rem}
.brand{display:flex;align-items:center;gap:.6rem}.brand img{width:28px}
.brand h1{font-family:'Poppins',sans-serif;font-size:1.2rem;color:var(--azul)}
nav a{margin-left:1rem;color:var(--azul);text-decoration:none}
.btn{background:var(--salmao);color:#fff;border:none;border-radius:10px;padding:.55rem .9rem;font-weight:700;cursor:pointer}
.btn.secondary{background:#fff;color:var(--azul);border:1px solid var(--borda)}
.card{background:#fff;border:1px solid var(--borda);border-radius:14px;padding:1.2rem;margin-top:1rem}
h2{font-family:'Poppins',sans-serif;color:var(--azul);margin:.3rem 0 .6rem}
h3{color:#0e1d33;margin:.8rem 0 .4rem}
p{line-height:1.7;color:#303540}
.small{font-size:.92rem;color:#6b7380}
.badge{display:inline-block;border:1px solid var(--borda);border-radius:999px;padding:.2rem .6rem;background:#f7f9ff;font-size:.85rem;margin-left:.5rem}
.notice{background:#f2fff5;border:1px solid #cdebd4;border-radius:12px;padding:1rem;margin-top:1rem}
.warn{background:#fff7f5;border:1px dashed #ffd5cb;border-radius:12px;padding:1rem;margin-top:1rem}
.hr{height:1px;background:var(--borda);margin:1rem 0}
</style>
</head>
<body>
<div class="wrap">
  <header class="top">
    <div class="brand"><img src="assets/logo.svg" alt=""><h1>Braintest</h1></div>
    <nav>
      <a href="index.html">Início</a>
      <a href="carteira.html">Carteira</a>
      <a href="historico.html">Histórico</a>
      <span id="userInfo" class="badge">Carregando…</span>
    </nav>
  </header>

  <section id="bannerOk" class="notice" style="display:none">
    <strong>Compra concluída!</strong>
    <p class="small">Seu acesso a este relatório premium foi liberado.</p>
  </section>

  <section id="guard" class="warn" style="display:none">
    <strong>Sem acesso ao relatório.</strong>
    <p class="small">Você ainda não desbloqueou o relatório premium de QI. Faça a triagem e compre pelo botão de desbloqueio (10 Braincoins).</p>
    <div style="margin-top:.6rem">
      <button class="btn" onclick="location.href='teste-qi.html'">Fazer triagem</button>
      <button class="btn secondary" onclick="location.href='carteira.html'">Adicionar Braincoins</button>
    </div>
  </section>

  <section id="report" class="card" style="display:none">
    <h2>QI — Relatório Premium</h2>
    <p class="small">Estimativa numérica de QI e percentil com base na sua pontuação na triagem (indicativo; não é teste clínico padronizado).</p>
    <div class="hr"></div>

    <h3>Resultado</h3>
    <p>Com base na pontuação, a estimativa situaria seu QI em torno de <strong>100 ± 15</strong> (escala padrão), com percentil correspondente ao desempenho obtido na prova curta.</p>

    <h3>Interpretação</h3>
    <ul class="small">
      <li><strong>Lógico/numérico:</strong> práticas de sequências e problemas aritméticos elevam consistência.</li>
      <li><strong>Padrões/visuoespacial:</strong> treino com matrizes e puzzles acelera detecção de regularidades.</li>
      <li><strong>Verbal/curto:</strong> leitura diária e resumos concisos ajudam vocabulário e síntese.</li>
    </ul>

    <div class="hr"></div>
    <p class="small">Para resultados formais, são necessários testes aplicados por profissionais com padronização e normas específicas.</p>
  </section>
</div>

<script>
document.addEventListener('DOMContentLoaded', async ()=>{
  await waitForSupabaseSession();
  const { data:{ user } } = await sb.auth.getUser();
  const ui = document.getElementById('userInfo');

  if(!user){
    ui.textContent = 'Visitante';
    alert('Faça login para abrir seu relatório.');
    location.href = 'index.html';
    return;
  }
  ui.textContent = user.email || 'Usuário';

  const ok = new URLSearchParams(location.search).get('ok');
  if(ok) document.getElementById('bannerOk').style.display = 'block';

  const { data, error } = await sb
    .from('purchases')
    .select('id')
    .eq('user_id', user.id)
    .eq('product', 'qi')
    .limit(1);

  if(error || !data || data.length===0){
    document.getElementById('guard').style.display = 'block';
  }else{
    document.getElementById('report').style.display = 'block';
  }
});
</script>
</body>
</html>
