<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Teste de Q.I. ‚Äî Braintest</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@600&display=swap" rel="stylesheet">
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
:root{--salmao:#ff8a73;--azul:#1d3557;--cinza:#f8f9fb}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif}
body{background:var(--cinza);color:#333;line-height:1.7}
header{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background:var(--azul);color:#fff}
.logo{display:flex;align-items:center;gap:.5rem}
.logo h1{font-family:'Poppins',sans-serif;font-size:1.5rem}
nav a{color:#fff;text-decoration:none;margin-left:1rem;font-weight:600}
nav a:hover{text-decoration:underline}
main{max-width:900px;margin:2rem auto;padding:2rem;background:#fff;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,.05)}
h2{color:var(--azul);font-family:'Poppins',sans-serif;margin-bottom:1rem}
.btn{background:var(--salmao);color:#fff;padding:.7rem 1.4rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;display:inline-block;margin-top:1rem;text-decoration:none}
.btn.secondary{background:#fff;color:var(--azul);border:1px solid #dde3ee}
.btn:hover{background:#ff7458}
.question{margin-bottom:1.2rem}
.result-box{margin-top:2rem;padding:1.5rem;border-radius:8px;background:#fef5f4}
footer{text-align:center;padding:2rem;color:#666;font-size:.9rem}
</style>
<script>
const SUPABASE_URL="https://gqwgyresqsuciikmymkd.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdxd2d5cmVzcXN1Y2lpa215bWtkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzNDQ5NTIsImV4cCI6MjA3NTkyMDk1Mn0.e9EfNqXvrujJm9jmG5SCJ2EShoq0PAbxTuv1kvs0FnQ";
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);
const PRECO_BC=10;
</script>
</head>
<body>
<header>
  <div class="logo"><img src="assets/logo.svg" width="32" height="32" alt=""><h1>Braintest</h1></div>
  <nav>
  <a href="index.html">In√≠cio</a>
  <a href="carteira.html">Carteira</a>
  <a href="historico.html">Hist√≥rico</a>
  <a href="sobre.html">Sobre</a>
  <span id="user-info"></span>
  <button id="logout-btn" class="btn secondary" style="display:none;padding:.4rem 1rem;margin-left:.5rem;">Sair</button>
</nav>

</header>

<main>
  <h2>Teste de Q.I.</h2>
  <p>Vers√£o simplificada de racioc√≠nio l√≥gico, num√©rico e padr√µes. Resultado estimado ‚Äî n√£o substitui avalia√ß√£o profissional.</p>

  <form id="qiForm" style="margin-top:1.5rem;">
    <div id="questions"></div>
    <button type="submit" class="btn">Enviar respostas</button>
  </form>

  <div id="resultado" class="result-box" style="display:none;"></div>
</main>

<footer>¬© 2025 Braintest ‚Äî Todos os direitos reservados.</footer>

<script>
const perguntas=[
  {q:"Se 2 gatos ca√ßam 2 ratos em 2 minutos, quantos gatos seriam necess√°rios para ca√ßar 20 ratos em 20 minutos?",a:["2","4","6","10"],c:0},
  {q:"Complete a sequ√™ncia: 3, 6, 12, 24, ?",a:["36","48","46","50"],c:1},
  {q:"Maria √© irm√£ de Jo√£o. Jo√£o √© pai de Pedro. O que Maria √© de Pedro?",a:["M√£e","Tia","Av√≥","Prima"],c:1},
  {q:"Qual n√∫mero completa a s√©rie: 2, 4, 8, 16, 32, ?",a:["48","60","64","72"],c:2},
  {q:"Se todos os A s√£o B e alguns B s√£o C, ent√£o:",a:["Todos os A s√£o C","Nenhum C √© A","Alguns A podem ser C","Todos os C s√£o A"],c:2},
  {q:"Qual √© o pr√≥ximo n√∫mero da sequ√™ncia: 1, 1, 2, 3, 5, 8, ?",a:["11","12","13","13"],c:3},
  {q:"Se hoje √© quarta-feira, que dia ser√° daqui a 10 dias?",a:["S√°bado","Domingo","Segunda-feira","Sexta-feira"],c:1},
  {q:"Quantos lados tem 4 tri√¢ngulos juntos formando um quadrado?",a:["8","10","12","14"],c:2},
  {q:"Um trem leva 1h para percorrer 60 km. Qual √© sua velocidade m√©dia?",a:["60 km/h","120 km/h","30 km/h","90 km/h"],c:0},
  {q:"Se 5x = 20, ent√£o x =",a:["2","3","4","5"],c:2},
  {q:"Complete a sequ√™ncia: A, C, F, J, O, ?",a:["Q","S","U","V"],c:2},
  {q:"Qual figura n√£o pertence ao grupo: c√≠rculo, tri√¢ngulo, quadrado, esfera?",a:["C√≠rculo","Tri√¢ngulo","Esfera","Quadrado"],c:2},
  {q:"Se o rel√≥gio marca 3:15, qual o √¢ngulo entre o ponteiro das horas e o dos minutos?",a:["0¬∞","7,5¬∞","30¬∞","60¬∞"],c:3},
  {q:"Qual n√∫mero √© logicamente diferente dos demais: 2, 3, 5, 9, 11?",a:["2","9","11","3"],c:1},
  {q:"Se 1=3, 2=3, 3=5, 4=4, 5=4, ent√£o 6=?",a:["3","4","5","6"],c:1}
];

const qDiv=document.getElementById("questions");
perguntas.forEach((p,i)=>{
  const d=document.createElement("div"); d.classList.add("question");
  d.innerHTML=`<label>${i+1}. ${p.q}</label><br>`+p.a.map((r,idx)=>`<label><input type="radio" name="q${i}" value="${idx}"> ${r}</label>`).join("<br>");
  qDiv.appendChild(d);
});

document.getElementById("qiForm").addEventListener("submit",(e)=>{
  e.preventDefault();
  let score=0; perguntas.forEach((p,i)=>{ const v=document.querySelector(`input[name="q${i}"]:checked`); if(v && parseInt(v.value)===p.c) score++; });
  const qi=80+(score*4);
  let msg=""; if(qi<90) msg=`Seu Q.I. estimado √© ${qi}. Desempenho abaixo da m√©dia, com espa√ßo para desenvolvimento.`;
  else if(qi<110) msg=`Seu Q.I. estimado √© ${qi}. Voc√™ est√° dentro da m√©dia da popula√ß√£o.`;
  else msg=`Seu Q.I. estimado √© ${qi}. Desempenho acima da m√©dia, excelente racioc√≠nio.`;

  const box=document.getElementById("resultado");
  box.innerHTML=`<h3>Resultado da triagem:</h3><p>${msg}</p>
  <p style="margin-top:1rem;">Relat√≥rio premium detalhado: <strong>${PRECO_BC} Braincoins</strong>.</p>
  <button class="btn" onclick="comprarRelatorio()">Comprar com Braincoins (${PRECO_BC} BC)</button>`;
  box.style.display="block"; window.scrollTo({top:box.offsetTop,behavior:'smooth'});
});

// Sess√£o
document.addEventListener("DOMContentLoaded",async()=>{
  const {data:{user}}=await sb.auth.getUser();
  const ui=document.getElementById("user-info"); const out=document.getElementById("logout-btn");
  if(user){ ui.textContent=`üë§ ${user.email}`; out.style.display="inline-block"; }
});
async function logout(){ await sb.auth.signOut(); location.reload(); }

// D√©bito Braincoin + purchase
async function comprarRelatorio(){
  const { data:{user} } = await sb.auth.getUser();
  if(!user){ alert("Fa√ßa login para continuar."); return; }
  const preco=PRECO_BC*100;
  const { data:wallet } = await sb.from('wallets').select('balance_cents').eq('user_id',user.id).single();
  const saldo=wallet?.balance_cents ?? 0;
  if(saldo<preco){ alert("Saldo insuficiente. Adicione Braincoins."); location.href="carteira.html"; return; }

  const novo=saldo-preco;
  const { data:upd, error:err } = await sb.from('wallets')
    .update({ balance_cents:novo })
    .eq('user_id',user.id)
    .eq('balance_cents',saldo)
    .select();
  if(err || !upd || !upd.length){ alert("N√£o foi poss√≠vel concluir a compra. Tente novamente."); return; }

  await sb.from('wallet_transactions').insert({ user_id:user.id, kind:'spend', amount_cents:preco, description:'Relat√≥rio Premium QI' });
  await sb.from('purchases').insert({ user_id:user.id, product:'qi' }).catch(()=>{});

  location.href="qi-premium.html";
}
</script>
</body>
</html>
